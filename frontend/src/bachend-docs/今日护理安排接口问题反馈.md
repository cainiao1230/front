# 今日护理安排接口问题反馈及修改需求

## 📋 问题描述

### 当前问题
`GET /api/care/tasks/today` 接口目前只返回**分配给当前登录用户**的任务，导致：
- admin 用户登录后看不到任何今日任务（因为任务分配给护工）
- 护工之间无法查看其他同事的任务安排

### 业务需求
首页"今日护理安排"模块的目的是**展示今天所有的护理任务**，方便：
1. 管理员总览今日所有护理工作
2. 护工之间相互了解彼此的任务安排，便于交流协作
3. 任务表格已有"责任人"列，可以清晰看到每个任务由谁负责

---

## 🔧 建议修改方案

### 方案：今日任务接口返回所有今日任务

**接口：** `GET /api/care/tasks/today`

**修改前（当前）：**
```sql
-- 只返回分配给当前用户的今日任务
SELECT * FROM care_tasks 
WHERE DATE(scheduled_time) = CURRENT_DATE 
  AND assigned_to = :current_user_id
```

**修改后（建议）：**
```sql
-- 返回所有今日任务，不限制用户
SELECT * FROM care_tasks 
WHERE DATE(scheduled_time) = CURRENT_DATE
ORDER BY scheduled_time ASC
```

---

## 📝 接口规格

### GET /api/care/tasks/today

**说明：** 返回今天所有护理任务（不区分用户）

**响应格式：**
```json
{
  "code": 0,
  "message": "ok",
  "data": {
    "items": [
      {
        "id": 3,
        "elderly_id": 2,
        "elderly_name": "王奶奶",
        "title": "康复训练",
        "description": "协助王奶奶进行下肢康复训练",
        "priority": "medium",
        "status": "in_progress",
        "assigned_to": 5,
        "assigned_to_name": "护工王五",
        "scheduled_time": "2026-01-20T18:30:00",
        "completed_at": null
      },
      {
        "id": 4,
        "elderly_id": 2,
        "elderly_name": "王奶奶",
        "title": "营养餐配送",
        "description": "为王奶奶配送低糖营养餐",
        "priority": "medium",
        "status": "pending",
        "assigned_to": 5,
        "assigned_to_name": "护工王五",
        "scheduled_time": "2026-01-20T20:30:00",
        "completed_at": null
      }
    ],
    "total": 2
  }
}
```

**关键字段：**
- `assigned_to_name` - 责任人姓名（必须返回，用于在界面上显示负责的护工）

---

## 🎯 前端临时方案

在后端修改之前，前端已做临时处理：
- 使用 `GET /api/care/tasks` 获取所有任务
- 前端过滤 `scheduled_time` 为今天日期的任务

**代码位置：** `src/views/dashboard/HomeView.vue` - `loadTasks()` 方法

**注意：** 这是临时方案，会多加载一些数据。建议后端尽快修改接口。

---

## ✅ 验收标准

1. admin 用户登录首页，能看到今天所有护理任务
2. 护工用户登录首页，也能看到今天所有护理任务（不仅仅是自己的）
3. 每条任务显示：老人信息、任务类型、执行时间、**责任人**、状态

---

## 📊 相关截图说明

### 护理任务管理页面
- ID 3（王奶奶-康复训练）计划时间：2026-01-20T18:30 - **进行中**
- ID 4（王奶奶-营养餐配送）计划时间：2026-01-20T20:30 - **待处理**

这两条是今天的任务，应该在首页"今日护理安排"中显示。

---

## 📞 优先级

**高** - 影响首页核心功能展示

---

**反馈时间：** 2026-01-20  
**前端开发：** 已完成临时方案  
**等待后端：** 修改 today 接口逻辑
